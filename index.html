
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Diapasón 12 trastes — Jónico</title>
<style>
  :root{
    --bg:#1b1b1b;
    --wood-a:#9a6234;
    --wood-b:#70421d;
    --wood-hi:rgba(255,240,220,.06);
    --wood-lo:rgba(0,0,0,.08);
    --string:#d7d7d7;
    --cell-h:62px;
    --dot-size:36px;
    --maxw:1300px;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    background:var(--bg); color:#ececec;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    display:flex; justify-content:center; padding:22px;
  }

  main{ width:100%; max-width:var(--maxw) }
  h1{ margin-bottom:12px; font-size:20px; font-weight:650; text-align:center }

  .fretboard{
    position:relative; overflow:hidden; border-radius:12px;
    background:
      linear-gradient(90deg, var(--wood-a), var(--wood-b)),
      repeating-linear-gradient(
        90deg,
        var(--wood-hi) 0 4px,
        transparent 4px 10px,
        var(--wood-lo) 10px 12px,
        transparent 12px 18px
      );
    background-blend-mode:multiply;
    box-shadow:0 8px 22px rgba(0,0,0,.5);
  }

  .cells{
    display:grid;
    grid-template-rows:repeat(6, var(--cell-h));
    grid-template-columns:
      100fr 97fr 94fr 91fr 88fr 85fr 82fr 79fr 76fr 73fr 70fr 67fr; /* proporciones conservadas */
    position:relative;
    z-index:2;
  }

  .cell{
    position:relative;
    display:flex; align-items:center; justify-content:center;
    border-right:2px solid rgba(245,245,245,.65);
  }
  .cell:nth-child(12n+1){ border-left:3px solid rgba(245,245,245,.85) } /* traste 1 */

  .note{
    width:var(--dot-size); height:var(--dot-size);
    border-radius:50%;
    background:#fff; color:#000;
    font-weight:700; font-size:13px;
    display:flex; align-items:center; justify-content:center;
    box-shadow:0 2px 4px rgba(0,0,0,.40);
    z-index:5;
    user-select:none;
    /* al cargar: TODO visible */
  }
  /* Colores al filtrar */
  .tonic{ background:#c81e1e; color:#fff }
  .in-scale{ background:#1f6feb; color:#fff }

  .strings{
    pointer-events:none;
    position:absolute; inset:0;
    z-index:1;
  }
  .strings::before{
    content:""; position:absolute; left:0; right:0; top:0; bottom:0;
    background:
      linear-gradient(to right, var(--string), var(--string)) 0 calc(var(--cell-h)*0.5) / 100% 1.6px,
      linear-gradient(to right, var(--string), var(--string)) 0 calc(var(--cell-h)*1.5) / 100% 1.8px,
      linear-gradient(to right, var(--string), var(--string)) 0 calc(var(--cell-h)*2.5) / 100% 2px,
      linear-gradient(to right, var(--string), var(--string)) 0 calc(var(--cell-h)*3.5) / 100% 2.2px,
      linear-gradient(to right, var(--string), var(--string)) 0 calc(var(--cell-h)*4.5) / 100% 2.5px,
      linear-gradient(to right, var(--string), var(--string)) 0 calc(var(--cell-h)*5.5) / 100% 3px;
    background-repeat:no-repeat;
    opacity:.95;
    filter:drop-shadow(0 1px 0 rgba(0,0,0,.35));
  }

  .fret-numbers{
    margin-top:8px;
    display:grid;
    grid-template-columns:
      100fr 97fr 94fr 91fr 88fr 85fr 82fr 79fr 76fr 73fr 70fr 67fr;
    text-align:center;
  }
  .fret-numbers span{ font-size:14px; color:#f0f0f0; opacity:.95; user-select:none }

  /* Controles */
  .controls{
    margin-top:20px; text-align:center;
  }
  select, button{
    font-size:14px; padding:6px 10px; margin:0 6px;
  }
  button{
    background:#444; color:#fff; border:1px solid #777; border-radius:4px;
    cursor:pointer;
  }
  button:hover{ background:#666 }
</style>
</head>
<body>
<main>
  <h1>Diapasón (12 trastes) — Jónico</h1>

  <div class="fretboard" id="fretboard">
    <div class="cells" id="cells"></div>
    <div class="strings" aria-hidden="true"></div>
  </div>
  <div class="fret-numbers" id="fretNumbers"></div>

  <div class="controls">
    <label>Tonalidad:
      <select id="keySelect">
        <!-- 15 armaduras/enarmónicas separadas -->
        <option value="C">C</option>
        <option value="C#">C#</option>
        <option value="Db">Db</option>
        <option value="D">D</option>
        <option value="D#">D#</option>
        <option value="Eb">Eb</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="F#">F#</option>
        <option value="Gb">Gb</option>
        <option value="G">G</option>
        <option value="G#">G#</option>
        <option value="Ab">Ab</option>
        <option value="A">A</option>
        <option value="A#">A#</option>
        <option value="Bb">Bb</option>
        <option value="B">B</option>
      </select>
    </label>
    <label>Escala:
      <select id="scaleSelect">
        <option value="ionian">Jónico (Mayor)</option>
      </select>
    </label>
    <button id="applyBtn">Aplicar</button>
  </div>
</main>

<script>
  /* --- DATOS BÁSICOS --- */
  const SHARP = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
  const FLAT  = ["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];
  // Texto visible en los círculos (como tenías: ambos nombres)
  const DISPLAY = ["C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","A#/Bb","B"];
  // Orden de cuerdas (1ª arriba → 6ª abajo), sin “al aire” en el dibujo (empezamos traste 1)
  const STRINGS_TOPDOWN = ["E","B","G","D","A","E"]; // 1ª→6ª
  const FRETS = 12;

  // Elegir si esa tonalidad prefiere bemoles (para futuro, si quisieras reescritura de nombres)
  function prefersFlats(key){
    return /b$/.test(key) || key === "F";
  }
  // Índice cromático del nombre (acepta C, C#, Db...)
  function idxOf(name){
    const iS = SHARP.indexOf(name);
    if (iS !== -1) return iS;
    return FLAT.indexOf(name);
  }

  /* --- CONSTRUCCIÓN DEL DIAPASÓN (TODO VISIBLE AL INICIO) --- */
  const cells = document.getElementById("cells");
  const circles = []; // guardo refs para luego filtrar
  for (let s=0; s<6; s++){
    const openIdx = idxOf(STRINGS_TOPDOWN[s]);
    for (let fret=1; fret<=FRETS; fret++){
      const noteIdx = (openIdx + fret) % 12;
      const cell = document.createElement("div");
      cell.className = "cell";
      const dot = document.createElement("div");
      dot.className = "note";
      dot.textContent = DISPLAY[noteIdx];
      dot.dataset.noteIdx = noteIdx; // guardo el índice puro
      cell.appendChild(dot);
      cells.appendChild(cell);
      circles.push(dot);
    }
  }
  // Números de traste
  const nums = document.getElementById("fretNumbers");
  for (let f=1; f<=FRETS; f++){ const span=document.createElement("span"); span.textContent=f; nums.appendChild(span); }

  /* --- LÓGICA JÓNICO (Mayor) --- */
  // Intervalos mayor (jónico): 0,2,4,5,7,9,11
  const IONIAN_OFFSETS = [0,2,4,5,7,9,11];

  function applyIonian(key){
    const rootIdx = idxOf(key);
    if (rootIdx < 0) return;

    // set de índices permitidos
    const inScale = new Set(IONIAN_OFFSETS.map(o => (rootIdx + o) % 12));

    // Mostrar/ocultar y colorear
    circles.forEach(dot=>{
      const ni = Number(dot.dataset.noteIdx);
      dot.style.display = inScale.has(ni) ? "flex" : "none";
      dot.classList.remove("tonic","in-scale");
      if (inScale.has(ni)){
        if (ni === rootIdx) dot.classList.add("tonic");
        else dot.classList.add("in-scale");
      }
    });
  }

  /* --- BOTÓN APLICAR --- */
  document.getElementById("applyBtn").addEventListener("click", ()=>{
    const key = document.getElementById("keySelect").value;        // tonalidad elegida
    const scale = document.getElementById("scaleSelect").value;    // de momento solo "ionian"
    if (scale === "ionian") applyIonian(key);
  });
</script>
</body>
</html>
